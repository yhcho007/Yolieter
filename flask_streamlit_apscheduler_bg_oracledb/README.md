# Task Management System

이 프로젝트는 Oracle 데이터베이스와 통신하여 작업을 관리하는 API를 제공합니다. Flask를 사용하여 RESTful API를 구현하고, Streamlit을 통해 사용자 인터페이스를 제공합니다. 또한, 백그라운드 작업을 처리하기 위해 `sch.py` 스크립트를 사용합니다.

## 구성 요소

### 1. main.py

`main.py`는 Flask 애플리케이션의 메인 파일로, 다음과 같은 기능을 제공합니다:

- **RESTful API**: 작업을 등록하고 조회할 수 있는 API 엔드포인트를 제공합니다.
- **백그라운드 프로세스 실행**: `sch.py`를 백그라운드에서 실행합니다.
- **신호 처리**: 프로세스가 종료될 때 관련된 모든 프로세스를 종료합니다.

#### 사용법

```bash
python main.py
```

### 2. dash_app.py
dash_app.py는 처음에는 streamlit를 이용했으나, Dash 가 더 가독성이 있는것 같아 Dash를 사용하는것으로 변경했습니다. 웹 기반 사용자 인터페이스를 제공합니다. 사용자들은 이 인터페이스를 통해 작업을 쉽게 관리하고, 등록, 시스템 자원을 모니터링 할 수 있습니다.
사용자로부터 taskid, taskname, subprocee_starttime, task_status를 입력받아 API에 POST 요청을 보내고, POST 응답을 표시합니다. 요청 입력란이 최상단에 위치하고, 그 아래로 막대 그래프, 테이블 데이터, 시스템 메트릭스, CPU 프로세스 데이터, 메모리 프로세스 데이터가 순서대로 표시됩니다.

## 주요 기능
작업 등록: 사용자가 새로운 작업을 등록할 수 있습니다.
작업 조회: 등록된 작업을 조회할 수 있습니다.
필터링: 특정 조건에 따라 작업을 필터링할 수 있습니다.

#### 사용법
```bash
python dash_app.py
```
브라우저에서 애플리케이션 보기:
애플리케이션이 실행되면 브라우저를 열고 http://127.0.0.1:8050로 이동하여 Dash 애플리케이션을 확인합니다.

### 3. sch.py
sch.py는 main.py에 의해 백그라운드에서 실행되는 스크립트로, 주기적으로 특정 작업을 수행합니다. 이 스크립트는 주로 데이터베이스와 상호작용하여 작업을 처리하는 데 사용됩니다.

#### 사용법
이 스크립트는 main.py에서 자동으로 실행됩니다. 별도로 실행하려면 다음 명령어를 사용할 수 있습니다.

```bash
python sch.py
```
### 4. app.py
app.py는 기동시간에 특정 작업을 수행하는 데 필요한 로직을 포함하고 있습니다. 이 스크립트는 taskid 인자를 받아서 작업을 처리합니다.

#### 사용법
이 스크립트는 sch.py에서 자동으로 실행됩니다. 별도로 실행하려면 다음 명령어를 사용할 수 있습니다.

```bash
python app.py --taskid <taskid>
```

### 테이블 정의
```bash
CREATE TABLE task (
    taskid NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    taskname VARCHAR2(100) NOT NULL,
    subprocee_starttime TIMESTAMP NOT NULL,
    task_status VARCHAR2(20) DEFAULT 'I' NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    changed_at TIMESTAMP
);

```

## 요구 사항
Python 3.12.3
리눅스의 경우 gunicorn

## 설치
프로젝트를 클론한 후, 필요한 패키지를 설치합니다.

### requirements.txt
```bash
Flask==3.1.1
flask_restx==1.3.0
APScheduler==4.0.0a6
oracledb==3.1.0
pandas==2.2.3
dash==3.0.4
plotly==6.1.0rc0
psutil==7.0.0
#gunicorn==22.0.0
#supervisor==6.3.0
```
이 내용을 requirements.txt 파일로 저장하면, 필요한 패키지를 쉽게 설치할 수 있습니다. 설치하려면 다음 명령어를 사용할 수 있습니다

```bash
pip install -r requirements.txt
```
패키지 의존성에 의해 추가적인 패키지 들이 설치 될 수있는데, requirements.txt 로 설치 후 pip freeze > requirements_full.txt 하여 requirements_full.txt 에서 확인 바랍니다. 

## docker-compose up 으로 기동하기
이 docker-compose.yml 파일이 있는 디렉토리에서 터미널을 열고 docker-compose up --build 명령어를 실행하면 이미지를 빌드하고 컨테이너를 실행할 수 있어! 
--build는 변경사항이 있을 때 이미지를 다시 빌드하라는 뜻이야. 백그라운드로 실행하고 싶으면 -d 옵션을 추가해서 docker-compose up -d --build 라고 하면 돼.
자, 이렇게 해서 네 Flask+Dash 앱을 Openshift 환경에 배포하기 위한 기본적인 Dockerfile과 docker-compose.yml, 설정 파일들을 만들어봤어! 😊

이 파일들과 함께 네 파이썬 코드(main.py, dash_app.py, sch.py)를 같은 디렉토리에 넣고 docker-compose up --build 로 로컬에서 먼저 테스트해보는 걸 추천해! 
포트 5000으로 API (http://localhost:5000/swagger 로 Swagger UI 확인 가능!) 접근이 되는지, 8501 포트로 Dash 앱이 잘 뜨는지 확인해봐!

Openshift 배포 자체는 oc 명령어나 웹 콘솔을 사용하게 될 텐데, 이 Dockerfile을 바탕으로 이미지를 빌드하고 Openshift DeploymentConfig/Deployment를 생성하면 돼. 
Openshift 환경에서의 세부 설정(Route, Secret, Resource Limit 등)은 프로젝트 특성에 맞게 추가로 설정해야 해


## 라이센스
이 프로젝트는 MIT 라이센스 하에 배포됩니다.


### 설명

- **프로젝트 개요**: 프로젝트의 목적과 기능을 간단히 설명합니다.
- **구성 요소**: 각 스크립트의 기능과 사용법을 자세히 설명합니다.
- **요구 사항**: 이 프로젝트를 실행하기 위해 필요한 라이브러리와 패키지를 나열합니다.
- **설치 방법**: 프로젝트를 설치하는 방법을 안내합니다.
- **라이센스**: 프로젝트의 라이센스를 명시합니다.

### 에러처리
#### pip 에러
from pip._internal.cli.main import main as _main
ModuleNotFoundError: No module named 'pip._internal'

위와 같은 에러가 발생하여, 다음과 같이 처리하고 패키지 삭제 후 다시 설치함.
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
python get-pip.py

### 참고한 URL 감사합니다!!!
[Oracle Database 23ai Free Platforms windows 버전설치](https://download.oracle.com/otn-pub/otn_software/db-express/WINDOWS.X64_238000_free.zip)

[Oracle-오라클-계정-생성-삭제-테이블-스페이스-생성-삭제-계정-권한-부여](https://daftcoder.tistory.com/entry/Oracle-%EC%98%A4%EB%9D%BC%ED%81%B4-%EA%B3%84%EC%A0%95-%EC%83%9D%EC%84%B1-%EC%82%AD%EC%A0%9C-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4-%EC%83%9D%EC%84%B1-%EC%82%AD%EC%A0%9C-%EA%B3%84%EC%A0%95-%EA%B6%8C%ED%95%9C-%EB%B6%80%EC%97%AC)




